# ai_processing.py
import json
from transformers import pipeline
analisaSentimento=[]
pontuacao=0
tweets={'user_info': {'description': 'founder @FURIA 🇧🇷', 'username': 'jaimepadua', 'id': '34398147', 'profile_image_url': 'https://pbs.twimg.com/profile_images/1747293705533288454/8RWY44Hs_normal.jpg', 'name': 'FURIA jaimepadua', 'created_at': '2009-04-22T21:06:20.000Z', 'public_metrics': {'followers_count': 47214, 'following_count': 1876, 'tweet_count': 20856, 'listed_count': 112, 'like_count': 54723, 'media_count': 727}}, 'tweets': [{'id': '1918101210390761757', 'text': 'RT @FURIA: VITÓRIA da #FURIAApex no game 6! 🔥\n\nVAMOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO\n\n@FURIA_USA @pOkizGames https…', 'created_at': '2025-05-02T00:32:19.000Z', 'edit_history_tweet_ids': ['1918101210390761757'], 'public_metrics': {'retweet_count': 11, 'reply_count': 0, 'like_count': 0, 'quote_count': 0, 'bookmark_count': 0, 'impression_count': 1}}, {'id': '1918073769727328265', 'text': '@dudolagordola @FURIA seria legal, mas o calendário não colabora com a reduzida quantidade de jogos e as mudanças agora também, mas vamos melhorar nisso tb 👊🏼', 'created_at': '2025-05-01T22:43:17.000Z', 'edit_history_tweet_ids': ['1918073769727328265'], 'public_metrics': {'retweet_count': 0, 'reply_count': 0, 'like_count': 18, 'quote_count': 0, 'bookmark_count': 0, 'impression_count': 758}}, {'id': '1918066788606132316', 'text': '✅ Finais do Mundial de PUBG - amanhã\n✅ começo excelente no Mundial de APEX - hoje\n\na @FURIA está competindo em todo lugar \ne onde não tá legal, vai ficar! \n\npodem confiar! 🇧🇷', 'created_at': '2025-05-01T22:15:33.000Z', 'edit_history_tweet_ids': ['1918066788606132316'], 'public_metrics': {'retweet_count': 9, 'reply_count': 41, 'like_count': 423, 'quote_count': 4, 'bookmark_count': 4, 'impression_count': 22939}}, {'id': '1918063386757132363', 'text': 'agora temos nosso @tvoy_molodoy sem ping 100 e com todas as condições de mostrar seu potencial... \n\né o Rock Lee sem os pesos! seguraaaaa!! https://t.co/MOf959znVH https://t.co/uZ7IAWR3Ge', 'created_at': '2025-05-01T22:02:01.000Z', 'edit_history_tweet_ids': ['1918063386757132363'], 'public_metrics': {'retweet_count': 0, 'reply_count': 7, 'like_count': 199, 'quote_count': 0, 'bookmark_count': 0, 'impression_count': 7023}}, {'id': '1918063119793893744', 'text': 'RT @FURIA: Ол келді! Ele chegou! 🇧🇷🇰🇿\n\n@tvoy_molodoy de visto aprovado e junto da #FURIACS! https://t.co/pavzQprpNv', 'created_at': '2025-05-01T22:00:58.000Z', 'edit_history_tweet_ids': ['1918063119793893744'], 'public_metrics': {'retweet_count': 81, 'reply_count': 0, 'like_count': 0, 'quote_count': 0, 'bookmark_count': 0, 'impression_count': 0}}, {'id': '1918027235207901516', 'text': '@FURIA present ✅', 'created_at': '2025-05-01T19:38:22.000Z', 'edit_history_tweet_ids': ['1918027235207901516'], 'public_metrics': {'retweet_count': 0, 'reply_count': 0, 'like_count': 16, 'quote_count': 0, 'bookmark_count': 0, 'impression_count': 1034}}, {'id': '1917668775878336523', 'text': '@andradebarbarCS @FURIA estamos num período de reavaliação, com planos de internacionalização neste sentido também - quando tiver mais concreto comunicaremos a respeito 👊', 'created_at': '2025-04-30T19:53:59.000Z', 'edit_history_tweet_ids': ['1917668775878336523'], 'public_metrics': {'retweet_count': 0, 'reply_count': 2, 'like_count': 39, 'quote_count': 1, 'bookmark_count': 0, 'impression_count': 2641}}, {'id': '1917645995866833015', 'text': '"aahhh jaime, se você comprar o fulano eu compro a skin da @FURIA!" \n\ntá achando que os times vão aceitar cartão de crédito, irmão? ajuda ai po 🤣 https://t.co/LUdO36Umyw', 'created_at': '2025-04-30T18:23:28.000Z', 'edit_history_tweet_ids': ['1917645995866833015'], 'public_metrics': {'retweet_count': 7, 'reply_count': 82, 'like_count': 786, 'quote_count': 7, 'bookmark_count': 10, 'impression_count': 59098}}, {'id': '1917617321041916039', 'text': "RT @FURIA: molodoy paved the way for KZ...\nNow it's @krizzencsgo's time to join #FURIACS! 🇰🇿🐾\n\nDamos as boas-vindas ao KrizzeN como novo As…", 'created_at': '2025-04-30T16:29:31.000Z', 'edit_history_tweet_ids': ['1917617321041916039'], 'public_metrics': {'retweet_count': 25, 'reply_count': 0, 'like_count': 0, 'quote_count': 0, 'bookmark_count': 0, 'impression_count': 0}}, {'id': '1917616973044658190', 'text': 'RT @FURIA: O carro bicho da #FURIAPUBG ta chegando pra Final do mundial! ESTAMOS CLASSIFICADOS! 🇧🇷\n\nNos vemos nas manhãs de sexta a domingo…', 'created_at': '2025-04-30T16:28:08.000Z', 'edit_history_tweet_ids': ['1917616973044658190'], 'public_metrics': {'retweet_count': 11, 'reply_count': 0, 'like_count': 0, 'quote_count': 0, 'bookmark_count': 0, 'impression_count': 0}}], 'furia_mentions': [{'tweet_id': '1918101210390761757', 'text': 'RT @FURIA: VITÓRIA da #FURIAApex no game 6! 🔥\n\nVAMOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO\n\n@FURIA_USA @pOkizGames https…', 'created_at': '2025-05-02T00:32:19.000Z', 'likes': 0}, {'tweet_id': '1918073769727328265', 'text': '@dudolagordola @FURIA seria legal, mas o calendário não colabora com a reduzida quantidade de jogos e as mudanças agora também, mas vamos melhorar nisso tb 👊🏼', 'created_at': '2025-05-01T22:43:17.000Z', 'likes': 18}, {'tweet_id': '1918066788606132316', 'text': '✅ Finais do Mundial de PUBG - amanhã\n✅ começo excelente no Mundial de APEX - hoje\n\na @FURIA está competindo em todo lugar \ne onde não tá legal, vai ficar! \n\npodem confiar! 🇧🇷', 'created_at': '2025-05-01T22:15:33.000Z', 'likes': 423}, {'tweet_id': '1918063386757132363', 'text': 'agora temos nosso @tvoy_molodoy sem ping 100 e com todas as condições de mostrar seu potencial... \n\né o Rock Lee sem os pesos! seguraaaaa!! https://t.co/MOf959znVH https://t.co/uZ7IAWR3Ge', 'created_at': '2025-05-01T22:02:01.000Z', 'likes': 199}, {'tweet_id': '1918063119793893744', 'text': 'RT @FURIA: Ол келді! Ele chegou! 🇧🇷🇰🇿\n\n@tvoy_molodoy de visto aprovado e junto da #FURIACS! https://t.co/pavzQprpNv', 'created_at': '2025-05-01T22:00:58.000Z', 'likes': 0}, {'tweet_id': '1918027235207901516', 'text': '@FURIA present ✅', 'created_at': '2025-05-01T19:38:22.000Z', 'likes': 16}, {'tweet_id': '1917668775878336523', 'text': '@andradebarbarCS @FURIA estamos num período de reavaliação, com planos de internacionalização neste sentido também - quando tiver mais concreto comunicaremos a respeito 👊', 'created_at': '2025-04-30T19:53:59.000Z', 'likes': 39}, {'tweet_id': '1917645995866833015', 'text': '"aahhh jaime, se você comprar o fulano eu compro a skin da @FURIA!" \n\ntá achando que os times vão aceitar cartão de crédito, irmão? ajuda ai po 🤣 https://t.co/LUdO36Umyw', 'created_at': '2025-04-30T18:23:28.000Z', 'likes': 786}, {'tweet_id': '1917617321041916039', 'text': "RT @FURIA: molodoy paved the way for KZ...\nNow it's @krizzencsgo's time to join #FURIACS! 🇰🇿🐾\n\nDamos as boas-vindas ao KrizzeN como novo As…", 'created_at': '2025-04-30T16:29:31.000Z', 'likes': 0}, {'tweet_id': '1917616973044658190', 'text': 'RT @FURIA: O carro bicho da #FURIAPUBG ta chegando pra Final do mundial! ESTAMOS CLASSIFICADOS! 🇧🇷\n\nNos vemos nas manhãs de sexta a domingo…', 'created_at': '2025-04-30T16:28:08.000Z', 'likes': 0}], 'furia_sentiment_score': 10}
def analisaTweets(tweets):
    textos_tweets = [tweet['text'] for tweet in tweets['tweets']]
    pontuacao = 0  # Inicializa o contador

    ia = pipeline(task="text-classification", model="cardiffnlp/twitter-roberta-base-sentiment")
    resultados = ia(textos_tweets)

    for tweet, resultado in zip(textos_tweets, resultados):
        if resultado['label'] == 'LABEL_0':
            resultado['label'] = 'NEGATIVO'
        if resultado['label'] == 'LABEL_1':
            resultado['label'] = 'POSITIVO'
            pontuacao += 10  # Agora a variável está definida
        if resultado['label'] == 'LABEL_2':
            resultado['label'] = 'NEUTRO'
            pontuacao += 5
        print(f"Tweet: {tweet}\nSentimento: {resultado['label']} (Score: {resultado['score']:.2f})\n")

        tweet_result = {
            'tweet': tweet,
            'sentimento': resultado['label'],
            'confidence': resultado['score']  # Guarda o score de confiança do modelo
        }

        analisaSentimento.append(tweet_result)

    final_output = {
            'total_score': pontuacao,
            'tweet_analysis': analisaSentimento
    }

    return final_output